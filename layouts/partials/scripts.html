<!-- third-party libraries -->
{{ range .Site.Params.externalJSFiles -}}
<script src="{{ $.Site.Params.staticPrefix }}{{ . | relURL }}"></script>
{{- end }}
<script type="module">
/* === lazyload === */
var lazyLoadInstance = new LazyLoad();
lazyLoadInstance.update();

/* === Fancybox === */
Fancybox.bind("[data-fancybox]");

/* === tocbot === */
function loadToc() {
  tocbot.init({
    tocSelector: '#toc',
    contentSelector: '#post-content',
    headingSelector: 'h2, h3:not(blockquote > h3)',
    hasInnerContainers: true,
    scrollSmoothOffset: -30
  });
}
loadToc();

/* === littlefoot === */
littlefoot.littlefoot(littlefootOptions)

/* === giscus === */
function loadGiscus() {
  const giscusContainer = document.querySelector('.giscus'); // Make sure this matches your Giscus container class
  if (giscusContainer) {
      // Remove old Giscus iframe
      giscusContainer.innerHTML = '';

      // Create and append a new script
      const script = document.createElement('script');
      script.src = 'https://giscus.app/client.js';
      script.setAttribute('data-repo', 'your/repo');
      script.setAttribute('data-repo-id', 'your-repo-id');
      script.setAttribute('data-category', 'General');
      script.setAttribute('data-category-id', 'your-category-id');
      script.setAttribute('data-mapping', 'pathname');
      script.setAttribute('data-strict', '0');
      script.setAttribute('data-reactions-enabled', '1');
      script.setAttribute('data-emit-metadata', '0');
      script.setAttribute('data-input-position', 'bottom');
      script.setAttribute('data-theme', 'light');
      script.setAttribute('data-lang', 'en');
      script.crossOrigin = 'anonymous';
      script.async = true;

      giscusContainer.appendChild(script);
  }
}

/* === swup === */
const swup = new Swup({
  linkSelector: 'a[href]:not(.no-swup)'
});
swup.hooks.on('page:view', () => {
  lazyLoadInstance.update();
  Fancybox.bind("[data-fancybox]");
  loadToc();
  littlefoot.littlefoot(littlefootOptions);
  initCalHeatmap();
  initPagefind();
  loadGiscus();
});
</script>
